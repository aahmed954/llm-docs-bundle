import{s as rl,o as ml,n as pl}from"../chunks/scheduler.8c3d61f6.js";import{S as cl,i as ul,g as i,s as a,r as m,A as dl,h as o,f as l,c as n,j as nl,u as c,x as p,k as il,y as hl,a as s,v as u,d,t as h,w as f}from"../chunks/index.da70eac4.js";import{T as ol}from"../chunks/Tip.1d9b8c37.js";import{C as y}from"../chunks/CodeBlock.a9c4becf.js";import{D as fl}from"../chunks/DocNotebookDropdown.48852948.js";import{H as je,E as Ml}from"../chunks/index.5d4ab994.js";function yl(Je){let r,w='Learn more details in the <a href="#how-does-parallelization-work">How does parallelization work?</a> section.';return{c(){r=i("p"),r.innerHTML=w},l(M){r=o(M,"P",{"data-svelte-h":!0}),p(r)!=="svelte-5pbnhk"&&(r.innerHTML=w)},m(M,T){s(M,r,T)},p:pl,d(M){M&&l(r)}}}function wl(Je){let r,w="You need to ensure all your inputs have the same shape in subsequent calls, otherwise JAX will need to recompile the code which is slower.";return{c(){r=i("p"),r.textContent=w},l(M){r=o(M,"P",{"data-svelte-h":!0}),p(r)!=="svelte-jgm5rf"&&(r.textContent=w)},m(M,T){s(M,r,T)},p:pl,d(M){M&&l(r)}}}function Tl(Je){let r,w,M,T,j,Ue,g,$e,U,vt="ü§ó Diffusers supports Flax for super fast inference on Google TPUs, such as those available in Colab, Kaggle or Google Cloud Platform. This guide shows you how to run inference with Stable Diffusion using JAX/Flax.",ve,$,_t="Before you begin, make sure you have the necessary libraries installed:",_e,v,Be,_,Bt="You should also make sure you‚Äôre using a TPU backend. While JAX does not run exclusively on TPUs, you‚Äôll get the best performance on a TPU because each server has 8 TPU accelerators working in parallel.",Ce,B,Ct="If you are running this guide in Colab, select <em>Runtime</em> in the menu above, select the option <em>Change runtime type</em>, and then select <em>TPU</em> under the <em>Hardware accelerator</em> setting. Import JAX and quickly check whether you‚Äôre using a TPU:",Ie,C,xe,I,It="Great, now you can import the rest of the dependencies you‚Äôll need:",ke,x,We,k,Ge,W,xt="Flax is a functional framework, so models are stateless and parameters are stored outside of them. Loading a pretrained Flax pipeline returns <em>both</em> the pipeline and the model weights (or parameters). In this guide, you‚Äôll use <code>bfloat16</code>, a more efficient half-float type that is supported by TPUs (you can also use <code>float32</code> for full precision if you want).",Xe,G,Ze,X,He,Z,kt="TPUs usually have 8 devices working in parallel, so let‚Äôs use the same prompt for each device. This means you can perform inference on 8 devices at once, with each device generating one image. As a result, you‚Äôll get 8 images in the same amount of time it takes for one chip to generate a single image!",Fe,b,Ye,H,Wt="After replicating the prompt, get the tokenized text ids by calling the <code>prepare_inputs</code> function on the pipeline. The length of the tokenized text is set to 77 tokens as required by the configuration of the underlying CLIP text model.",Qe,F,ze,Y,Gt='Model parameters and inputs have to be replicated across the 8 parallel devices. The parameters dictionary is replicated with <a href="https://flax.readthedocs.io/en/latest/api_reference/flax.jax_utils.html#flax.jax_utils.replicate" rel="nofollow"><code>flax.jax_utils.replicate</code></a> which traverses the dictionary and changes the shape of the weights so they are repeated 8 times. Arrays are replicated using <code>shard</code>.',Ee,Q,Re,z,Xt="This shape means each one of the 8 devices receives as an input a <code>jnp</code> array with shape <code>(1, 77)</code>, where <code>1</code> is the batch size per device. On TPUs with sufficient memory, you could have a batch size larger than <code>1</code> if you want to generate multiple images (per chip) at once.",Le,E,Zt="Next, create a random number generator to pass to the generation function. This is standard procedure in Flax, which is very serious and opinionated about random numbers. All functions that deal with random numbers are expected to receive a generator to ensure reproducibility, even when you‚Äôre training across multiple distributed devices.",Ne,R,Ht="The helper function below uses a seed to initialize a random number generator. As long as you use the same seed, you‚Äôll get the exact same results. Feel free to use different seeds when exploring results later in the guide.",Se,L,Ve,N,Ft="The helper function, or <code>rng</code>, is split 8 times so each device receives a different generator and generates a different image.",Ae,S,Pe,V,Yt="To take advantage of JAX‚Äôs optimized speed on a TPU, pass <code>jit=True</code> to the pipeline to compile the JAX code into an efficient representation and to ensure the model runs in parallel across the 8 devices.",qe,J,De,A,Qt="The first inference run takes more time because it needs to compile the code, but subsequent calls (even with different inputs) are much faster. For example, it took more than a minute to compile on a TPU v2-8, but then it takes about <strong>7s</strong> on a future inference run!",Ke,P,Oe,q,zt='The returned array has shape <code>(8, 1, 512, 512, 3)</code> which should be reshaped to remove the second dimension and get 8 images of <code>512 √ó 512 √ó 3</code>. Then you can use the <a href="/docs/diffusers/v0.33.1/en/api/utilities#diffusers.utils.numpy_to_pil">numpy_to_pil()</a> function to convert the arrays into images.',et,D,tt,K,Et='<img src="https://huggingface.co/datasets/YiYiXu/test-doc-assets/resolve/main/stable_diffusion_jax_how_to_cell_38_output_0.jpeg" alt="img"/>',lt,O,st,ee,Rt="You don‚Äôt necessarily have to use the same prompt on all devices. For example, to generate 8 different prompts:",at,te,nt,le,Lt='<img src="https://huggingface.co/datasets/YiYiXu/test-doc-assets/resolve/main/stable_diffusion_jax_how_to_cell_43_output_0.jpeg" alt="img"/>',it,se,ot,ae,Nt="The Flax pipeline in ü§ó Diffusers automatically compiles the model and runs it in parallel on all available devices. Let‚Äôs take a closer look at how that process works.",pt,ne,St='JAX parallelization can be done in multiple ways. The easiest one revolves around using the <a href="https://jax.readthedocs.io/en/latest/_autosummary/jax.pmap.html" rel="nofollow"><code>jax.pmap</code></a> function to achieve single-program multiple-data (SPMD) parallelization. It means running several copies of the same code, each on different data inputs. More sophisticated approaches are possible, and you can go over to the JAX <a href="https://jax.readthedocs.io/en/latest/index.html" rel="nofollow">documentation</a> to explore this topic in more detail if you are interested!',rt,ie,Vt="<code>jax.pmap</code> does two things:",mt,oe,At="<li>Compiles (or ‚Äù<code>jit</code>s‚Äù) the code which is similar to <code>jax.jit()</code>. This does not happen when you call <code>pmap</code>, and only the first time the <code>pmap</code>ped function is called.</li> <li>Ensures the compiled code runs in parallel on all available devices.</li>",ct,pe,Pt="To demonstrate, call <code>pmap</code> on the pipeline‚Äôs <code>_generate</code> method (this is a private method that generates images and may be renamed or removed in future releases of ü§ó Diffusers):",ut,re,dt,me,qt="After calling <code>pmap</code>, the prepared function <code>p_generate</code> will:",ht,ce,Dt="<li>Make a copy of the underlying function, <code>pipeline._generate</code>, on each device.</li> <li>Send each device a different portion of the input arguments (this is why it‚Äôs necessary to call the <em>shard</em> function). In this case, <code>prompt_ids</code> has shape <code>(8, 1, 77, 768)</code> so the array is split into 8 and each copy of <code>_generate</code> receives an input with shape <code>(1, 77, 768)</code>.</li>",ft,ue,Kt="The most important thing to pay attention to here is the batch size (1 in this example), and the input dimensions that make sense for your code. You don‚Äôt have to change anything else to make the code work in parallel.",Mt,de,Ot="The first time you call the pipeline takes more time, but the calls afterward are much faster. The <code>block_until_ready</code> function is used to correctly measure inference time because JAX uses asynchronous dispatch and returns control to the Python loop as soon as it can. You don‚Äôt need to use that in your code; blocking occurs automatically when you want to use the result of a computation that has not yet been materialized.",yt,he,wt,fe,el="Check your image dimensions to see if they‚Äôre correct:",Tt,Me,bt,ye,Jt,we,tl="To learn more about how JAX works with Stable Diffusion, you may be interested in reading:",jt,Te,ll='<li><a href="https://hf.co/blog/sdxl_jax" rel="nofollow">Accelerating Stable Diffusion XL Inference with JAX on Cloud TPU v5e</a></li>',gt,be,Ut,ge,$t;return j=new je({props:{title:"JAX/Flax",local:"jaxflax",headingTag:"h1"}}),g=new fl({props:{classNames:"absolute z-10 right-0 top-0",options:[{label:"Mixed",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/main/diffusers_doc/en/stable_diffusion_jax_how_to.ipynb"},{label:"PyTorch",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/main/diffusers_doc/en/pytorch/stable_diffusion_jax_how_to.ipynb"},{label:"TensorFlow",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/main/diffusers_doc/en/tensorflow/stable_diffusion_jax_how_to.ipynb"},{label:"Mixed",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/main/diffusers_doc/en/stable_diffusion_jax_how_to.ipynb"},{label:"PyTorch",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/main/diffusers_doc/en/pytorch/stable_diffusion_jax_how_to.ipynb"},{label:"TensorFlow",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/main/diffusers_doc/en/tensorflow/stable_diffusion_jax_how_to.ipynb"}]}}),v=new y({props:{code:"JTIzJTIwdW5jb21tZW50JTIwdG8lMjBpbnN0YWxsJTIwdGhlJTIwbmVjZXNzYXJ5JTIwbGlicmFyaWVzJTIwaW4lMjBDb2xhYiUwQSUyMyFwaXAlMjBpbnN0YWxsJTIwLXElMjBqYXglM0QlM0QwLjMuMjUlMjBqYXhsaWIlM0QlM0QwLjMuMjUlMjBmbGF4JTIwdHJhbnNmb3JtZXJzJTIwZnRmeSUwQSUyMyFwaXAlMjBpbnN0YWxsJTIwLXElMjBkaWZmdXNlcnM=",highlighted:`<span class="hljs-comment"># uncomment to install the necessary libraries in Colab</span>
<span class="hljs-comment">#!pip install -q jax==0.3.25 jaxlib==0.3.25 flax transformers ftfy</span>
<span class="hljs-comment">#!pip install -q diffusers</span>`,wrap:!1}}),C=new y({props:{code:"aW1wb3J0JTIwamF4JTBBaW1wb3J0JTIwamF4LnRvb2xzLmNvbGFiX3RwdSUwQWpheC50b29scy5jb2xhYl90cHUuc2V0dXBfdHB1KCklMEElMEFudW1fZGV2aWNlcyUyMCUzRCUyMGpheC5kZXZpY2VfY291bnQoKSUwQWRldmljZV90eXBlJTIwJTNEJTIwamF4LmRldmljZXMoKSU1QjAlNUQuZGV2aWNlX2tpbmQlMEElMEFwcmludChmJTIyRm91bmQlMjAlN0JudW1fZGV2aWNlcyU3RCUyMEpBWCUyMGRldmljZXMlMjBvZiUyMHR5cGUlMjAlN0JkZXZpY2VfdHlwZSU3RC4lMjIpJTBBYXNzZXJ0JTIwKCUwQSUyMCUyMCUyMCUyMCUyMlRQVSUyMiUyMGluJTIwZGV2aWNlX3R5cGUlMkMlMEElMjAlMjAlMjAlMjAlMjJBdmFpbGFibGUlMjBkZXZpY2UlMjBpcyUyMG5vdCUyMGElMjBUUFUlMkMlMjBwbGVhc2UlMjBzZWxlY3QlMjBUUFUlMjBmcm9tJTIwUnVudGltZSUyMCUzRSUyMENoYW5nZSUyMHJ1bnRpbWUlMjB0eXBlJTIwJTNFJTIwSGFyZHdhcmUlMjBhY2NlbGVyYXRvciUyMiUwQSklMEElMjMlMjBGb3VuZCUyMDglMjBKQVglMjBkZXZpY2VzJTIwb2YlMjB0eXBlJTIwQ2xvdWQlMjBUUFUu",highlighted:`<span class="hljs-keyword">import</span> jax
<span class="hljs-keyword">import</span> jax.tools.colab_tpu
jax.tools.colab_tpu.setup_tpu()

num_devices = jax.device_count()
device_type = jax.devices()[<span class="hljs-number">0</span>].device_kind

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found <span class="hljs-subst">{num_devices}</span> JAX devices of type <span class="hljs-subst">{device_type}</span>.&quot;</span>)
<span class="hljs-keyword">assert</span> (
    <span class="hljs-string">&quot;TPU&quot;</span> <span class="hljs-keyword">in</span> device_type,
    <span class="hljs-string">&quot;Available device is not a TPU, please select TPU from Runtime &gt; Change runtime type &gt; Hardware accelerator&quot;</span>
)
<span class="hljs-comment"># Found 8 JAX devices of type Cloud TPU.</span>`,wrap:!1}}),x=new y({props:{code:"aW1wb3J0JTIwamF4Lm51bXB5JTIwYXMlMjBqbnAlMEFmcm9tJTIwamF4JTIwaW1wb3J0JTIwcG1hcCUwQWZyb20lMjBmbGF4LmpheF91dGlscyUyMGltcG9ydCUyMHJlcGxpY2F0ZSUwQWZyb20lMjBmbGF4LnRyYWluaW5nLmNvbW1vbl91dGlscyUyMGltcG9ydCUyMHNoYXJkJTBBJTBBZnJvbSUyMGRpZmZ1c2VycyUyMGltcG9ydCUyMEZsYXhTdGFibGVEaWZmdXNpb25QaXBlbGluZQ==",highlighted:`<span class="hljs-keyword">import</span> jax.numpy <span class="hljs-keyword">as</span> jnp
<span class="hljs-keyword">from</span> jax <span class="hljs-keyword">import</span> pmap
<span class="hljs-keyword">from</span> flax.jax_utils <span class="hljs-keyword">import</span> replicate
<span class="hljs-keyword">from</span> flax.training.common_utils <span class="hljs-keyword">import</span> shard

<span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> FlaxStableDiffusionPipeline`,wrap:!1}}),k=new je({props:{title:"Load a model",local:"load-a-model",headingTag:"h2"}}),G=new y({props:{code:"ZHR5cGUlMjAlM0QlMjBqbnAuYmZsb2F0MTYlMEFwaXBlbGluZSUyQyUyMHBhcmFtcyUyMCUzRCUyMEZsYXhTdGFibGVEaWZmdXNpb25QaXBlbGluZS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIyQ29tcFZpcyUyRnN0YWJsZS1kaWZmdXNpb24tdjEtNCUyMiUyQyUwQSUyMCUyMCUyMCUyMHZhcmlhbnQlM0QlMjJiZjE2JTIyJTJDJTBBJTIwJTIwJTIwJTIwZHR5cGUlM0RkdHlwZSUyQyUwQSk=",highlighted:`dtype = jnp.bfloat16
pipeline, params = FlaxStableDiffusionPipeline.from_pretrained(
    <span class="hljs-string">&quot;CompVis/stable-diffusion-v1-4&quot;</span>,
    variant=<span class="hljs-string">&quot;bf16&quot;</span>,
    dtype=dtype,
)`,wrap:!1}}),X=new je({props:{title:"Inference",local:"inference",headingTag:"h2"}}),b=new ol({props:{$$slots:{default:[yl]},$$scope:{ctx:Je}}}),F=new y({props:{code:"cHJvbXB0JTIwJTNEJTIwJTIyQSUyMGNpbmVtYXRpYyUyMGZpbG0lMjBzdGlsbCUyMG9mJTIwTW9yZ2FuJTIwRnJlZW1hbiUyMHN0YXJyaW5nJTIwYXMlMjBKaW1pJTIwSGVuZHJpeCUyQyUyMHBvcnRyYWl0JTJDJTIwNDBtbSUyMGxlbnMlMkMlMjBzaGFsbG93JTIwZGVwdGglMjBvZiUyMGZpZWxkJTJDJTIwY2xvc2UlMjB1cCUyQyUyMHNwbGl0JTIwbGlnaHRpbmclMkMlMjBjaW5lbWF0aWMlMjIlMEFwcm9tcHQlMjAlM0QlMjAlNUJwcm9tcHQlNUQlMjAqJTIwamF4LmRldmljZV9jb3VudCgpJTBBcHJvbXB0X2lkcyUyMCUzRCUyMHBpcGVsaW5lLnByZXBhcmVfaW5wdXRzKHByb21wdCklMEFwcm9tcHRfaWRzLnNoYXBlJTBBJTIzJTIwKDglMkMlMjA3Nyk=",highlighted:`prompt = <span class="hljs-string">&quot;A cinematic film still of Morgan Freeman starring as Jimi Hendrix, portrait, 40mm lens, shallow depth of field, close up, split lighting, cinematic&quot;</span>
prompt = [prompt] * jax.device_count()
prompt_ids = pipeline.prepare_inputs(prompt)
prompt_ids.shape
<span class="hljs-comment"># (8, 77)</span>`,wrap:!1}}),Q=new y({props:{code:"JTIzJTIwcGFyYW1ldGVycyUwQXBfcGFyYW1zJTIwJTNEJTIwcmVwbGljYXRlKHBhcmFtcyklMEElMEElMjMlMjBhcnJheXMlMEFwcm9tcHRfaWRzJTIwJTNEJTIwc2hhcmQocHJvbXB0X2lkcyklMEFwcm9tcHRfaWRzLnNoYXBlJTBBJTIzJTIwKDglMkMlMjAxJTJDJTIwNzcp",highlighted:`<span class="hljs-comment"># parameters</span>
p_params = replicate(params)

<span class="hljs-comment"># arrays</span>
prompt_ids = shard(prompt_ids)
prompt_ids.shape
<span class="hljs-comment"># (8, 1, 77)</span>`,wrap:!1}}),L=new y({props:{code:"ZGVmJTIwY3JlYXRlX2tleShzZWVkJTNEMCklM0ElMEElMjAlMjAlMjAlMjByZXR1cm4lMjBqYXgucmFuZG9tLlBSTkdLZXkoc2VlZCk=",highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_key</span>(<span class="hljs-params">seed=<span class="hljs-number">0</span></span>):
    <span class="hljs-keyword">return</span> jax.random.PRNGKey(seed)`,wrap:!1}}),S=new y({props:{code:"cm5nJTIwJTNEJTIwY3JlYXRlX2tleSgwKSUwQXJuZyUyMCUzRCUyMGpheC5yYW5kb20uc3BsaXQocm5nJTJDJTIwamF4LmRldmljZV9jb3VudCgpKQ==",highlighted:`rng = create_key(<span class="hljs-number">0</span>)
rng = jax.random.split(rng, jax.device_count())`,wrap:!1}}),J=new ol({props:{warning:!0,$$slots:{default:[wl]},$$scope:{ctx:Je}}}),P=new y({props:{code:"JTI1JTI1dGltZSUwQWltYWdlcyUyMCUzRCUyMHBpcGVsaW5lKHByb21wdF9pZHMlMkMlMjBwX3BhcmFtcyUyQyUyMHJuZyUyQyUyMGppdCUzRFRydWUpJTVCMCU1RCUwQSUwQSUyMyUyMENQVSUyMHRpbWVzJTNBJTIwdXNlciUyMDU2LjIlMjBzJTJDJTIwc3lzJTNBJTIwNDIuNSUyMHMlMkMlMjB0b3RhbCUzQSUyMDFtaW4lMjAzOHMlMEElMjMlMjBXYWxsJTIwdGltZSUzQSUyMDFtaW4lMjAyOXM=",highlighted:`%%time
images = pipeline(prompt_ids, p_params, rng, jit=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]

<span class="hljs-comment"># CPU times: user 56.2 s, sys: 42.5 s, total: 1min 38s</span>
<span class="hljs-comment"># Wall time: 1min 29s</span>`,wrap:!1}}),D=new y({props:{code:"ZnJvbSUyMGRpZmZ1c2Vycy51dGlscyUyMGltcG9ydCUyMG1ha2VfaW1hZ2VfZ3JpZCUwQSUwQWltYWdlcyUyMCUzRCUyMGltYWdlcy5yZXNoYXBlKChpbWFnZXMuc2hhcGUlNUIwJTVEJTIwKiUyMGltYWdlcy5zaGFwZSU1QjElNUQlMkMpJTIwJTJCJTIwaW1hZ2VzLnNoYXBlJTVCLTMlM0ElNUQpJTBBaW1hZ2VzJTIwJTNEJTIwcGlwZWxpbmUubnVtcHlfdG9fcGlsKGltYWdlcyklMEFtYWtlX2ltYWdlX2dyaWQoaW1hZ2VzJTJDJTIwcm93cyUzRDIlMkMlMjBjb2xzJTNENCk=",highlighted:`<span class="hljs-keyword">from</span> diffusers.utils <span class="hljs-keyword">import</span> make_image_grid

images = images.reshape((images.shape[<span class="hljs-number">0</span>] * images.shape[<span class="hljs-number">1</span>],) + images.shape[-<span class="hljs-number">3</span>:])
images = pipeline.numpy_to_pil(images)
make_image_grid(images, rows=<span class="hljs-number">2</span>, cols=<span class="hljs-number">4</span>)`,wrap:!1}}),O=new je({props:{title:"Using different prompts",local:"using-different-prompts",headingTag:"h2"}}),te=new y({props:{code:"cHJvbXB0cyUyMCUzRCUyMCU1QiUwQSUyMCUyMCUyMCUyMCUyMkxhYnJhZG9yJTIwaW4lMjB0aGUlMjBzdHlsZSUyMG9mJTIwSG9rdXNhaSUyMiUyQyUwQSUyMCUyMCUyMCUyMCUyMlBhaW50aW5nJTIwb2YlMjBhJTIwc3F1aXJyZWwlMjBza2F0aW5nJTIwaW4lMjBOZXclMjBZb3JrJTIyJTJDJTBBJTIwJTIwJTIwJTIwJTIySEFMLTkwMDAlMjBpbiUyMHRoZSUyMHN0eWxlJTIwb2YlMjBWYW4lMjBHb2doJTIyJTJDJTBBJTIwJTIwJTIwJTIwJTIyVGltZXMlMjBTcXVhcmUlMjB1bmRlciUyMHdhdGVyJTJDJTIwd2l0aCUyMGZpc2glMjBhbmQlMjBhJTIwZG9scGhpbiUyMHN3aW1taW5nJTIwYXJvdW5kJTIyJTJDJTBBJTIwJTIwJTIwJTIwJTIyQW5jaWVudCUyMFJvbWFuJTIwZnJlc2NvJTIwc2hvd2luZyUyMGElMjBtYW4lMjB3b3JraW5nJTIwb24lMjBoaXMlMjBsYXB0b3AlMjIlMkMlMEElMjAlMjAlMjAlMjAlMjJDbG9zZS11cCUyMHBob3RvZ3JhcGglMjBvZiUyMHlvdW5nJTIwYmxhY2slMjB3b21hbiUyMGFnYWluc3QlMjB1cmJhbiUyMGJhY2tncm91bmQlMkMlMjBoaWdoJTIwcXVhbGl0eSUyQyUyMGJva2VoJTIyJTJDJTBBJTIwJTIwJTIwJTIwJTIyQXJtY2hhaXIlMjBpbiUyMHRoZSUyMHNoYXBlJTIwb2YlMjBhbiUyMGF2b2NhZG8lMjIlMkMlMEElMjAlMjAlMjAlMjAlMjJDbG93biUyMGFzdHJvbmF1dCUyMGluJTIwc3BhY2UlMkMlMjB3aXRoJTIwRWFydGglMjBpbiUyMHRoZSUyMGJhY2tncm91bmQlMjIlMkMlMEElNUQlMEElMEFwcm9tcHRfaWRzJTIwJTNEJTIwcGlwZWxpbmUucHJlcGFyZV9pbnB1dHMocHJvbXB0cyklMEFwcm9tcHRfaWRzJTIwJTNEJTIwc2hhcmQocHJvbXB0X2lkcyklMEElMEFpbWFnZXMlMjAlM0QlMjBwaXBlbGluZShwcm9tcHRfaWRzJTJDJTIwcF9wYXJhbXMlMkMlMjBybmclMkMlMjBqaXQlM0RUcnVlKS5pbWFnZXMlMEFpbWFnZXMlMjAlM0QlMjBpbWFnZXMucmVzaGFwZSgoaW1hZ2VzLnNoYXBlJTVCMCU1RCUyMColMjBpbWFnZXMuc2hhcGUlNUIxJTVEJTJDKSUyMCUyQiUyMGltYWdlcy5zaGFwZSU1Qi0zJTNBJTVEKSUwQWltYWdlcyUyMCUzRCUyMHBpcGVsaW5lLm51bXB5X3RvX3BpbChpbWFnZXMpJTBBJTBBbWFrZV9pbWFnZV9ncmlkKGltYWdlcyUyQyUyMDIlMkMlMjA0KQ==",highlighted:`prompts = [
    <span class="hljs-string">&quot;Labrador in the style of Hokusai&quot;</span>,
    <span class="hljs-string">&quot;Painting of a squirrel skating in New York&quot;</span>,
    <span class="hljs-string">&quot;HAL-9000 in the style of Van Gogh&quot;</span>,
    <span class="hljs-string">&quot;Times Square under water, with fish and a dolphin swimming around&quot;</span>,
    <span class="hljs-string">&quot;Ancient Roman fresco showing a man working on his laptop&quot;</span>,
    <span class="hljs-string">&quot;Close-up photograph of young black woman against urban background, high quality, bokeh&quot;</span>,
    <span class="hljs-string">&quot;Armchair in the shape of an avocado&quot;</span>,
    <span class="hljs-string">&quot;Clown astronaut in space, with Earth in the background&quot;</span>,
]

prompt_ids = pipeline.prepare_inputs(prompts)
prompt_ids = shard(prompt_ids)

images = pipeline(prompt_ids, p_params, rng, jit=<span class="hljs-literal">True</span>).images
images = images.reshape((images.shape[<span class="hljs-number">0</span>] * images.shape[<span class="hljs-number">1</span>],) + images.shape[-<span class="hljs-number">3</span>:])
images = pipeline.numpy_to_pil(images)

make_image_grid(images, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>)`,wrap:!1}}),se=new je({props:{title:"How does parallelization work?",local:"how-does-parallelization-work",headingTag:"h2"}}),re=new y({props:{code:"cF9nZW5lcmF0ZSUyMCUzRCUyMHBtYXAocGlwZWxpbmUuX2dlbmVyYXRlKQ==",highlighted:"p_generate = pmap(pipeline._generate)",wrap:!1}}),he=new y({props:{code:"JTI1JTI1dGltZSUwQWltYWdlcyUyMCUzRCUyMHBfZ2VuZXJhdGUocHJvbXB0X2lkcyUyQyUyMHBfcGFyYW1zJTJDJTIwcm5nKSUwQWltYWdlcyUyMCUzRCUyMGltYWdlcy5ibG9ja191bnRpbF9yZWFkeSgpJTBBJTBBJTIzJTIwQ1BVJTIwdGltZXMlM0ElMjB1c2VyJTIwMW1pbiUyMDE1cyUyQyUyMHN5cyUzQSUyMDE4LjIlMjBzJTJDJTIwdG90YWwlM0ElMjAxbWluJTIwMzRzJTBBJTIzJTIwV2FsbCUyMHRpbWUlM0ElMjAxbWluJTIwMTVz",highlighted:`%%time
images = p_generate(prompt_ids, p_params, rng)
images = images.block_until_ready()

<span class="hljs-comment"># CPU times: user 1min 15s, sys: 18.2 s, total: 1min 34s</span>
<span class="hljs-comment"># Wall time: 1min 15s</span>`,wrap:!1}}),Me=new y({props:{code:"aW1hZ2VzLnNoYXBlJTBBJTIzJTIwKDglMkMlMjAxJTJDJTIwNTEyJTJDJTIwNTEyJTJDJTIwMyk=",highlighted:`images.shape
<span class="hljs-comment"># (8, 1, 512, 512, 3)</span>`,wrap:!1}}),ye=new je({props:{title:"Resources",local:"resources",headingTag:"h2"}}),be=new Ml({props:{source:"https://github.com/huggingface/diffusers/blob/main/docs/source/en/using-diffusers/stable_diffusion_jax_how_to.md"}}),{c(){r=i("meta"),w=a(),M=i("p"),T=a(),m(j.$$.fragment),Ue=a(),m(g.$$.fragment),$e=a(),U=i("p"),U.textContent=vt,ve=a(),$=i("p"),$.textContent=_t,_e=a(),m(v.$$.fragment),Be=a(),_=i("p"),_.textContent=Bt,Ce=a(),B=i("p"),B.innerHTML=Ct,Ie=a(),m(C.$$.fragment),xe=a(),I=i("p"),I.textContent=It,ke=a(),m(x.$$.fragment),We=a(),m(k.$$.fragment),Ge=a(),W=i("p"),W.innerHTML=xt,Xe=a(),m(G.$$.fragment),Ze=a(),m(X.$$.fragment),He=a(),Z=i("p"),Z.textContent=kt,Fe=a(),m(b.$$.fragment),Ye=a(),H=i("p"),H.innerHTML=Wt,Qe=a(),m(F.$$.fragment),ze=a(),Y=i("p"),Y.innerHTML=Gt,Ee=a(),m(Q.$$.fragment),Re=a(),z=i("p"),z.innerHTML=Xt,Le=a(),E=i("p"),E.textContent=Zt,Ne=a(),R=i("p"),R.textContent=Ht,Se=a(),m(L.$$.fragment),Ve=a(),N=i("p"),N.innerHTML=Ft,Ae=a(),m(S.$$.fragment),Pe=a(),V=i("p"),V.innerHTML=Yt,qe=a(),m(J.$$.fragment),De=a(),A=i("p"),A.innerHTML=Qt,Ke=a(),m(P.$$.fragment),Oe=a(),q=i("p"),q.innerHTML=zt,et=a(),m(D.$$.fragment),tt=a(),K=i("p"),K.innerHTML=Et,lt=a(),m(O.$$.fragment),st=a(),ee=i("p"),ee.textContent=Rt,at=a(),m(te.$$.fragment),nt=a(),le=i("p"),le.innerHTML=Lt,it=a(),m(se.$$.fragment),ot=a(),ae=i("p"),ae.textContent=Nt,pt=a(),ne=i("p"),ne.innerHTML=St,rt=a(),ie=i("p"),ie.innerHTML=Vt,mt=a(),oe=i("ol"),oe.innerHTML=At,ct=a(),pe=i("p"),pe.innerHTML=Pt,ut=a(),m(re.$$.fragment),dt=a(),me=i("p"),me.innerHTML=qt,ht=a(),ce=i("ol"),ce.innerHTML=Dt,ft=a(),ue=i("p"),ue.textContent=Kt,Mt=a(),de=i("p"),de.innerHTML=Ot,yt=a(),m(he.$$.fragment),wt=a(),fe=i("p"),fe.textContent=el,Tt=a(),m(Me.$$.fragment),bt=a(),m(ye.$$.fragment),Jt=a(),we=i("p"),we.textContent=tl,jt=a(),Te=i("ul"),Te.innerHTML=ll,gt=a(),m(be.$$.fragment),Ut=a(),ge=i("p"),this.h()},l(e){const t=dl("svelte-u9bgzb",document.head);r=o(t,"META",{name:!0,content:!0}),t.forEach(l),w=n(e),M=o(e,"P",{}),nl(M).forEach(l),T=n(e),c(j.$$.fragment,e),Ue=n(e),c(g.$$.fragment,e),$e=n(e),U=o(e,"P",{"data-svelte-h":!0}),p(U)!=="svelte-12svr29"&&(U.textContent=vt),ve=n(e),$=o(e,"P",{"data-svelte-h":!0}),p($)!=="svelte-vd07ss"&&($.textContent=_t),_e=n(e),c(v.$$.fragment,e),Be=n(e),_=o(e,"P",{"data-svelte-h":!0}),p(_)!=="svelte-15famve"&&(_.textContent=Bt),Ce=n(e),B=o(e,"P",{"data-svelte-h":!0}),p(B)!=="svelte-1jp1nmd"&&(B.innerHTML=Ct),Ie=n(e),c(C.$$.fragment,e),xe=n(e),I=o(e,"P",{"data-svelte-h":!0}),p(I)!=="svelte-5ufrkr"&&(I.textContent=It),ke=n(e),c(x.$$.fragment,e),We=n(e),c(k.$$.fragment,e),Ge=n(e),W=o(e,"P",{"data-svelte-h":!0}),p(W)!=="svelte-349jsc"&&(W.innerHTML=xt),Xe=n(e),c(G.$$.fragment,e),Ze=n(e),c(X.$$.fragment,e),He=n(e),Z=o(e,"P",{"data-svelte-h":!0}),p(Z)!=="svelte-19grb2g"&&(Z.textContent=kt),Fe=n(e),c(b.$$.fragment,e),Ye=n(e),H=o(e,"P",{"data-svelte-h":!0}),p(H)!=="svelte-ih3iqi"&&(H.innerHTML=Wt),Qe=n(e),c(F.$$.fragment,e),ze=n(e),Y=o(e,"P",{"data-svelte-h":!0}),p(Y)!=="svelte-b3wqu4"&&(Y.innerHTML=Gt),Ee=n(e),c(Q.$$.fragment,e),Re=n(e),z=o(e,"P",{"data-svelte-h":!0}),p(z)!=="svelte-18q6dmb"&&(z.innerHTML=Xt),Le=n(e),E=o(e,"P",{"data-svelte-h":!0}),p(E)!=="svelte-j1l5pg"&&(E.textContent=Zt),Ne=n(e),R=o(e,"P",{"data-svelte-h":!0}),p(R)!=="svelte-1kfts0e"&&(R.textContent=Ht),Se=n(e),c(L.$$.fragment,e),Ve=n(e),N=o(e,"P",{"data-svelte-h":!0}),p(N)!=="svelte-bsl0kg"&&(N.innerHTML=Ft),Ae=n(e),c(S.$$.fragment,e),Pe=n(e),V=o(e,"P",{"data-svelte-h":!0}),p(V)!=="svelte-1sp1ijt"&&(V.innerHTML=Yt),qe=n(e),c(J.$$.fragment,e),De=n(e),A=o(e,"P",{"data-svelte-h":!0}),p(A)!=="svelte-1xv75ai"&&(A.innerHTML=Qt),Ke=n(e),c(P.$$.fragment,e),Oe=n(e),q=o(e,"P",{"data-svelte-h":!0}),p(q)!=="svelte-cc49ad"&&(q.innerHTML=zt),et=n(e),c(D.$$.fragment,e),tt=n(e),K=o(e,"P",{"data-svelte-h":!0}),p(K)!=="svelte-e1s2k"&&(K.innerHTML=Et),lt=n(e),c(O.$$.fragment,e),st=n(e),ee=o(e,"P",{"data-svelte-h":!0}),p(ee)!=="svelte-9e9hdw"&&(ee.textContent=Rt),at=n(e),c(te.$$.fragment,e),nt=n(e),le=o(e,"P",{"data-svelte-h":!0}),p(le)!=="svelte-1nea4f2"&&(le.innerHTML=Lt),it=n(e),c(se.$$.fragment,e),ot=n(e),ae=o(e,"P",{"data-svelte-h":!0}),p(ae)!=="svelte-1217ir9"&&(ae.textContent=Nt),pt=n(e),ne=o(e,"P",{"data-svelte-h":!0}),p(ne)!=="svelte-1toapy0"&&(ne.innerHTML=St),rt=n(e),ie=o(e,"P",{"data-svelte-h":!0}),p(ie)!=="svelte-1pwzekg"&&(ie.innerHTML=Vt),mt=n(e),oe=o(e,"OL",{"data-svelte-h":!0}),p(oe)!=="svelte-12i8xv7"&&(oe.innerHTML=At),ct=n(e),pe=o(e,"P",{"data-svelte-h":!0}),p(pe)!=="svelte-1gtj740"&&(pe.innerHTML=Pt),ut=n(e),c(re.$$.fragment,e),dt=n(e),me=o(e,"P",{"data-svelte-h":!0}),p(me)!=="svelte-1774hdu"&&(me.innerHTML=qt),ht=n(e),ce=o(e,"OL",{"data-svelte-h":!0}),p(ce)!=="svelte-12ig0qf"&&(ce.innerHTML=Dt),ft=n(e),ue=o(e,"P",{"data-svelte-h":!0}),p(ue)!=="svelte-w1m4t9"&&(ue.textContent=Kt),Mt=n(e),de=o(e,"P",{"data-svelte-h":!0}),p(de)!=="svelte-1ue3hjw"&&(de.innerHTML=Ot),yt=n(e),c(he.$$.fragment,e),wt=n(e),fe=o(e,"P",{"data-svelte-h":!0}),p(fe)!=="svelte-735q12"&&(fe.textContent=el),Tt=n(e),c(Me.$$.fragment,e),bt=n(e),c(ye.$$.fragment,e),Jt=n(e),we=o(e,"P",{"data-svelte-h":!0}),p(we)!=="svelte-1rrs38l"&&(we.textContent=tl),jt=n(e),Te=o(e,"UL",{"data-svelte-h":!0}),p(Te)!=="svelte-16herqb"&&(Te.innerHTML=ll),gt=n(e),c(be.$$.fragment,e),Ut=n(e),ge=o(e,"P",{}),nl(ge).forEach(l),this.h()},h(){il(r,"name","hf:doc:metadata"),il(r,"content",bl)},m(e,t){hl(document.head,r),s(e,w,t),s(e,M,t),s(e,T,t),u(j,e,t),s(e,Ue,t),u(g,e,t),s(e,$e,t),s(e,U,t),s(e,ve,t),s(e,$,t),s(e,_e,t),u(v,e,t),s(e,Be,t),s(e,_,t),s(e,Ce,t),s(e,B,t),s(e,Ie,t),u(C,e,t),s(e,xe,t),s(e,I,t),s(e,ke,t),u(x,e,t),s(e,We,t),u(k,e,t),s(e,Ge,t),s(e,W,t),s(e,Xe,t),u(G,e,t),s(e,Ze,t),u(X,e,t),s(e,He,t),s(e,Z,t),s(e,Fe,t),u(b,e,t),s(e,Ye,t),s(e,H,t),s(e,Qe,t),u(F,e,t),s(e,ze,t),s(e,Y,t),s(e,Ee,t),u(Q,e,t),s(e,Re,t),s(e,z,t),s(e,Le,t),s(e,E,t),s(e,Ne,t),s(e,R,t),s(e,Se,t),u(L,e,t),s(e,Ve,t),s(e,N,t),s(e,Ae,t),u(S,e,t),s(e,Pe,t),s(e,V,t),s(e,qe,t),u(J,e,t),s(e,De,t),s(e,A,t),s(e,Ke,t),u(P,e,t),s(e,Oe,t),s(e,q,t),s(e,et,t),u(D,e,t),s(e,tt,t),s(e,K,t),s(e,lt,t),u(O,e,t),s(e,st,t),s(e,ee,t),s(e,at,t),u(te,e,t),s(e,nt,t),s(e,le,t),s(e,it,t),u(se,e,t),s(e,ot,t),s(e,ae,t),s(e,pt,t),s(e,ne,t),s(e,rt,t),s(e,ie,t),s(e,mt,t),s(e,oe,t),s(e,ct,t),s(e,pe,t),s(e,ut,t),u(re,e,t),s(e,dt,t),s(e,me,t),s(e,ht,t),s(e,ce,t),s(e,ft,t),s(e,ue,t),s(e,Mt,t),s(e,de,t),s(e,yt,t),u(he,e,t),s(e,wt,t),s(e,fe,t),s(e,Tt,t),u(Me,e,t),s(e,bt,t),u(ye,e,t),s(e,Jt,t),s(e,we,t),s(e,jt,t),s(e,Te,t),s(e,gt,t),u(be,e,t),s(e,Ut,t),s(e,ge,t),$t=!0},p(e,[t]){const sl={};t&2&&(sl.$$scope={dirty:t,ctx:e}),b.$set(sl);const al={};t&2&&(al.$$scope={dirty:t,ctx:e}),J.$set(al)},i(e){$t||(d(j.$$.fragment,e),d(g.$$.fragment,e),d(v.$$.fragment,e),d(C.$$.fragment,e),d(x.$$.fragment,e),d(k.$$.fragment,e),d(G.$$.fragment,e),d(X.$$.fragment,e),d(b.$$.fragment,e),d(F.$$.fragment,e),d(Q.$$.fragment,e),d(L.$$.fragment,e),d(S.$$.fragment,e),d(J.$$.fragment,e),d(P.$$.fragment,e),d(D.$$.fragment,e),d(O.$$.fragment,e),d(te.$$.fragment,e),d(se.$$.fragment,e),d(re.$$.fragment,e),d(he.$$.fragment,e),d(Me.$$.fragment,e),d(ye.$$.fragment,e),d(be.$$.fragment,e),$t=!0)},o(e){h(j.$$.fragment,e),h(g.$$.fragment,e),h(v.$$.fragment,e),h(C.$$.fragment,e),h(x.$$.fragment,e),h(k.$$.fragment,e),h(G.$$.fragment,e),h(X.$$.fragment,e),h(b.$$.fragment,e),h(F.$$.fragment,e),h(Q.$$.fragment,e),h(L.$$.fragment,e),h(S.$$.fragment,e),h(J.$$.fragment,e),h(P.$$.fragment,e),h(D.$$.fragment,e),h(O.$$.fragment,e),h(te.$$.fragment,e),h(se.$$.fragment,e),h(re.$$.fragment,e),h(he.$$.fragment,e),h(Me.$$.fragment,e),h(ye.$$.fragment,e),h(be.$$.fragment,e),$t=!1},d(e){e&&(l(w),l(M),l(T),l(Ue),l($e),l(U),l(ve),l($),l(_e),l(Be),l(_),l(Ce),l(B),l(Ie),l(xe),l(I),l(ke),l(We),l(Ge),l(W),l(Xe),l(Ze),l(He),l(Z),l(Fe),l(Ye),l(H),l(Qe),l(ze),l(Y),l(Ee),l(Re),l(z),l(Le),l(E),l(Ne),l(R),l(Se),l(Ve),l(N),l(Ae),l(Pe),l(V),l(qe),l(De),l(A),l(Ke),l(Oe),l(q),l(et),l(tt),l(K),l(lt),l(st),l(ee),l(at),l(nt),l(le),l(it),l(ot),l(ae),l(pt),l(ne),l(rt),l(ie),l(mt),l(oe),l(ct),l(pe),l(ut),l(dt),l(me),l(ht),l(ce),l(ft),l(ue),l(Mt),l(de),l(yt),l(wt),l(fe),l(Tt),l(bt),l(Jt),l(we),l(jt),l(Te),l(gt),l(Ut),l(ge)),l(r),f(j,e),f(g,e),f(v,e),f(C,e),f(x,e),f(k,e),f(G,e),f(X,e),f(b,e),f(F,e),f(Q,e),f(L,e),f(S,e),f(J,e),f(P,e),f(D,e),f(O,e),f(te,e),f(se,e),f(re,e),f(he,e),f(Me,e),f(ye,e),f(be,e)}}}const bl='{"title":"JAX/Flax","local":"jaxflax","sections":[{"title":"Load a model","local":"load-a-model","sections":[],"depth":2},{"title":"Inference","local":"inference","sections":[],"depth":2},{"title":"Using different prompts","local":"using-different-prompts","sections":[],"depth":2},{"title":"How does parallelization work?","local":"how-does-parallelization-work","sections":[],"depth":2},{"title":"Resources","local":"resources","sections":[],"depth":2}],"depth":1}';function Jl(Je){return ml(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class Bl extends cl{constructor(r){super(),ul(this,r,Jl,Tl,rl,{})}}export{Bl as component};
